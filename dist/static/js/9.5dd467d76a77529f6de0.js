webpackJsonp([9],{mHSH:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s("olkN"),o={name:"dish",props:["id"],data:function(){return{dish:{id:null,createTime:"",updateTime:"",ifDel:0,name:"",price:null,imgUrl:"",description:"",point:null,totalScore:0,saltyScore:0,sourScore:0,hotScore:0,sweetScore:0,evaluationTimes:0,likesCount:0,collectionCount:0,restaurantId:null,restaurantName:"",createMangerId:null,updateMangerId:null,deleteMangerId:null},ifEvaluation:!1,ifLikesDish:!1,myScore:{totalScore:5,saltyScore:3,sourScore:3,hotScore:3,sweetScore:3},myReply:"",replyWhich:null,replyWhoName:null,currentReplyList:[],currentReplyFromName:[],currentReplyFromHeadUrl:[],currentReplyToName:[],currentReplyTo2Name:[],currentReplyToContent:[],currentReplyIfLike:[],replyCount:0,currentPage:1,sharedState:a.a.state}},methods:{refresh:function(){this.myReply=null,this.replyWhich=null,this.replyWhoName=null,this.currentReplyList=null,this.currentReplyFromName=null,this.currentReplyFromHeadUrl=null,this.currentReplyToName=null,this.currentReplyIfLike=null,this.currentReplyTo2Name=null,this.currentReplyToContent=null,this.ifEvaluation=!1,this.ifLikesDish=!1},handleScore:function(){var e=this;a.a.state.ifLogin?this.$http.post("/score/dish/add",{dishId:this.id,totalScore:this.myScore.totalScore,saltyScore:this.myScore.saltyScore,sourScore:this.myScore.sourScore,hotScore:this.myScore.hotScore,sweetScore:this.myScore.sweetScore}).then(function(t){0===t.data.code?(e.$Message.success("提交成功"),e.ifEvaluation=!0,e.$http.get("/dish/get/dish",{params:{id:e.id}}).then(function(t){0===t.data.code&&(e.dish=t.data.data)},function(t){e.$Message.error("服务器开小差了"),console.log(t)})):e.$Message.failed("提交失败，请重试")},function(t){e.$Message.error("服务器开小差了"),console.log(t)}):this.$Message.error("请登录再打分")},handleReply:function(){var e=this;if(a.a.state.ifLogin){if(this.myReply.length<5)return void this.$Message.error("评论请超过5个字！");this.$http.post("/user/reply",{dishId:this.id,content:this.myReply,toReplyId:this.replyWhich}).then(function(t){0===t.data.code?(e.$Message.success("提交成功"),e.replyCount++,e.showPage(1),e.myReply="",e.resetReplySb()):1===t.data.code?e.$Message.error("请登录再评论"):e.$Message.failed("提交失败，请重试")},function(t){e.$Message.error("服务器开小差了"),console.log(t)})}else this.$Message.error("请登录再评论")},showPage:function(e){var t=this,s=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.currentPage=e,this.$http.get("/reply/get/page",{params:{dishid:this.id,start:this.currentPage,size:10}}).then(function(e){0===e.data.code&&(t.currentReplyList=e.data.data.reply,t.currentReplyFromName=e.data.data.fromName,t.currentReplyFromHeadUrl=e.data.data.fromHeadUrl,t.currentReplyToName=e.data.data.toName,t.currentReplyIfLike=e.data.data.ifUserLike,t.currentReplyTo2Name=e.data.data.to2Name,t.currentReplyToContent=e.data.data.toContent)},function(e){t.$Message.error("服务器开小差了"),console.log(e)}),s&&document.getElementById("reply").scrollIntoView()},replySb:function(e,t){this.replyWhich=e,this.replyWhoName=t,document.getElementById("reply").scrollIntoView(),document.body.scrollTop-=70,document.documentElement.scrollTop-=70},resetReplySb:function(){this.replyWhoName=null,this.replyWhoName=null},likeDish:function(){var e=this;a.a.state.ifLogin?this.$http.post("/likes/dish",{dishid:parseInt(this.id)}).then(function(t){0===t.data.data.ifDel?(e.ifLikesDish=!0,e.dish.likesCount+=1):(e.ifLikesDish=!1,e.dish.likesCount-=1)},function(t){e.$Message.error("服务器开小差了"),console.log(t)}):this.$Message.error("请登录再点赞")},likeReply:function(e,t){var s=this;a.a.state.ifLogin?this.$http.post("/likes/reply",{replyid:e}).then(function(e){0===e.data.code&&s.showPage(s.currentPage,!1)},function(e){s.$Message.error("服务器开小差了"),console.log(e)}):this.$Message.error("请登录再点赞")},getlikeDish:function(){var e=this;a.a.state.ifLogin&&this.$http.get("/likes/get/dish",{params:{dishid:parseInt(this.id)}}).then(function(t){0===t.data.code&&(0===t.data.data.ifDel?e.ifLikesDish=!0:e.ifLikesDish=!1)},function(t){e.$Message.error("服务器开小差了"),console.log(t)})},getDishInfo:function(){var e=this;this.$http.get("/dish/get/dish",{params:{id:this.id}}).then(function(t){0===t.data.code&&(e.dish=t.data.data)},function(t){e.$Message.error("服务器开小差了"),console.log(t)})},getReplyCount:function(){var e=this;this.$http.get("/reply/get/count",{params:{dishid:this.id}}).then(function(t){0===t.data.code&&(e.replyCount=t.data.data)},function(t){e.$Message.error("服务器开小差了"),console.log(t)})},getScore:function(){var e=this;a.a.state.ifLogin&&this.$http.get("/score/dish/getscore",{params:{dishid:this.id}}).then(function(t){0===t.data.code?e.ifEvaluation=!0:e.ifEvaluation=!1},function(t){e.$Message.error("服务器开小差了"),console.log(t)})}},created:function(){this.getDishInfo(),this.getReplyCount(),this.showPage(1,!1),this.getlikeDish(),this.getScore()},watch:{ifLikesDish:{handler:function(e,t){},deep:!0},$route:function(e,t){this.refresh(),this.getDishInfo(),this.getReplyCount(),this.showPage(1,!1),this.getlikeDish(),this.getScore()}}},r={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("Row",{staticClass:"first-row code-row-bg",attrs:{type:"flex",justify:"center"}},[s("Col",{staticClass:"dish-col",attrs:{xs:22,sm:7,md:7,lg:7}},[s("Card",{staticClass:"dish-card"},[e.sharedState.ifShowImg?s("img",{staticClass:"img",attrs:{src:e.dish.imgUrl}}):e._e(),s("h2",[e._v(e._s(this.dish.name))]),e.ifLikesDish?e._e():s("svg",{staticClass:"icon icon-zan1",attrs:{"aria-hidden":"true"},on:{click:function(t){e.likeDish(!1)}}},[s("use",{attrs:{"xlink:href":"#icon-zan1"}})]),e.ifLikesDish?s("svg",{staticClass:"icon icon-zan",attrs:{"aria-hidden":"true"},on:{click:function(t){e.likeDish(!1)}}},[s("use",{attrs:{"xlink:href":"#icon-zan"}})]):e._e(),s("p",[e._v("餐厅："+e._s(e.dish.restaurantName))]),s("p",[e._v("价格：¥ "+e._s(e.dish.price)),s("Icon",{attrs:{type:"ios-pricetag-outline"}})],1),s("p",[e._v("描述："+e._s(e.dish.description))]),s("p",[e._v("发布时间："+e._s(e.dish.createTime))]),s("p",[e._v("收藏次数：（"+e._s(e.dish.collectionCount)+"）")]),s("p",[e._v("点赞数：（"+e._s(e.dish.likesCount)+"）")]),s("p",[e._v("评价次数：（"+e._s(e.dish.evaluationTimes)+"）")]),0!==e.dish.evaluationTimes?s("div",[s("p",[e._v("大众评分：")]),s("div",[s("span",[e._v("总评")]),s("Rate",{attrs:{disabled:"disabled","allow-half":"allow-half",value:parseFloat(e.dish.totalScore.toFixed(1)),"show-text":"show-text"}})],1),s("div",[s("Rate",{attrs:{disabled:"disabled","allow-half":"allow-half",value:parseFloat(e.dish.saltyScore.toFixed(1)),"show-text":"show-text",character:"咸"}})],1),s("div",[s("Rate",{attrs:{disabled:"disabled","allow-half":"allow-half",value:parseFloat(e.dish.sourScore.toFixed(1)),"show-text":"show-text",character:"酸"}})],1),s("div",[s("Rate",{attrs:{disabled:"disabled","allow-half":"allow-half",value:parseFloat(e.dish.hotScore.toFixed(1)),"show-text":"show-text",character:"辣"}})],1),s("div",[s("Rate",{attrs:{disabled:"disabled","allow-half":"allow-half",value:parseFloat(e.dish.sweetScore.toFixed(1)),"show-text":"show-text",character:"甜"}})],1)]):e._e()])],1),s("Col",{staticClass:"reply-col",attrs:{id:"reply",xs:{span:22,order:3},sm:{span:7,offset:1,order:2}}},[s("Card",{ref:"reply",staticClass:"reply-card"},[s("p",[e._v("添加评论:")]),null!==e.replyWhoName?s("Tag",{attrs:{color:"success",closable:"closable"},on:{"on-close":e.resetReplySb}},[e._v("回复：@"+e._s(e.replyWhoName))]):e._e(),s("Input",{attrs:{type:"textarea",autosize:{minRows:3,maxRows:3},placeholder:"吃过这个菜？写个回复吧"},model:{value:e.myReply,callback:function(t){e.myReply=t},expression:"myReply"}}),s("Row",{staticClass:"code-row-bg",attrs:{type:"flex",justify:"end"}},[s("Button",{staticStyle:{"margin-top":"3px"},attrs:{type:"primary",icon:"ios-undo"},on:{click:e.handleReply}},[e._v("评论")])],1)],1),e._l(e.currentReplyList,function(t,a){return s("div",{key:a},[s("Card",{staticClass:"reply-card"},[s("Avatar",{staticStyle:{color:"#f56a00","background-color":"#fde3cf"},attrs:{size:"large",src:e.currentReplyFromHeadUrl[a]}},[e._v(e._s(e.currentReplyFromName[a].substring(0,1)))]),s("h4",{staticStyle:{display:"inline","margin-left":"8px"}},[e._v(e._s(e.currentReplyFromName[a])+":")]),null!==t.toReplyId?s("div",[s("p",[e._v("回复 ---\x3e>>")]),s("Card",[s("h5",[e._v(e._s(e.currentReplyToName[a]))]),null!==e.currentReplyTo2Name[a]?s("h5",[e._v("回复@"+e._s(e.currentReplyTo2Name[a]))]):e._e(),s("p",[e._v("内容："+e._s(e.currentReplyToContent[a]))])])],1):e._e(),s("p",[e._v(e._s(t.content))]),s("h6",{staticStyle:{color:"#cccccc"}},[e._v("发布于 "+e._s(t.createTime))]),e.currentReplyIfLike[a]?e._e():s("Badge",{attrs:{dot:"dot",offset:[10,20]}},[s("Button",{staticStyle:{display:"inline"},attrs:{type:"text"},on:{click:function(s){e.likeReply(t.id,a)}}},[e._v("赞（"+e._s(t.likesCount)+"）")])],1),e.currentReplyIfLike[a]?s("p",{staticStyle:{display:"inline",color:"#ff9898"}},[e._v("已赞（"+e._s(t.likesCount)+"）")]):e._e(),s("Button",{attrs:{type:"text",icon:"ios-undo"},on:{click:function(s){e.replySb(t.id,e.currentReplyFromName[a])}}},[e._v("回复")])],1),s("Divider",{attrs:{type:"vertical"}})],1)}),s("Page",{attrs:{total:e.replyCount,size:"small","show-total":"show-total"},on:{"on-change":e.showPage}})],2),s("Col",{staticClass:"evaluation-col",attrs:{xs:{span:22,order:2},sm:{span:7,offset:1,order:2}}},[s("Card",{staticClass:"evaluation-card"},[s("p",{attrs:{slot:"title"},slot:"title"},[e._v("我的评分")]),e.ifEvaluation?e._e():s("div",[s("p",[e._v("请评价")]),s("p",[e._v("tips： 总评5星为最佳 其它3星为口味正好")]),s("div",[s("span",[e._v("总评")]),s("Rate",{attrs:{"show-text":"show-text"},model:{value:e.myScore.totalScore,callback:function(t){e.$set(e.myScore,"totalScore",t)},expression:"myScore.totalScore"}})],1),s("div",[s("Rate",{attrs:{"show-text":"show-text",character:"咸"},model:{value:e.myScore.saltyScore,callback:function(t){e.$set(e.myScore,"saltyScore",t)},expression:"myScore.saltyScore"}})],1),s("div",[s("Rate",{attrs:{"show-text":"show-text",character:"酸"},model:{value:e.myScore.sourScore,callback:function(t){e.$set(e.myScore,"sourScore",t)},expression:"myScore.sourScore"}})],1),s("div",[s("Rate",{attrs:{"show-text":"show-text",character:"辣"},model:{value:e.myScore.hotScore,callback:function(t){e.$set(e.myScore,"hotScore",t)},expression:"myScore.hotScore"}})],1),s("div",[s("Rate",{attrs:{"show-text":"show-text",character:"甜"},model:{value:e.myScore.sweetScore,callback:function(t){e.$set(e.myScore,"sweetScore",t)},expression:"myScore.sweetScore"}})],1),s("div",{staticClass:"evaluation-submit"},[s("Button",{on:{click:e.handleScore}},[e._v("提交")])],1)]),e.ifEvaluation?s("div",[s("p",[e._v("我的评价")]),s("div",[s("span",[e._v("总评")]),s("Rate",{attrs:{disabled:"disabled","allow-half":"allow-half","show-text":"show-text"},model:{value:e.myScore.totalScore,callback:function(t){e.$set(e.myScore,"totalScore",t)},expression:"myScore.totalScore"}})],1),s("div",[s("Rate",{attrs:{disabled:"disabled","allow-half":"allow-half","show-text":"show-text",character:"咸"},model:{value:e.myScore.saltyScore,callback:function(t){e.$set(e.myScore,"saltyScore",t)},expression:"myScore.saltyScore"}})],1),s("div",[s("Rate",{attrs:{disabled:"disabled","allow-half":"allow-half","show-text":"show-text",character:"酸"},model:{value:e.myScore.sourScore,callback:function(t){e.$set(e.myScore,"sourScore",t)},expression:"myScore.sourScore"}})],1),s("div",[s("Rate",{attrs:{disabled:"disabled","allow-half":"allow-half","show-text":"show-text",character:"辣"},model:{value:e.myScore.hotScore,callback:function(t){e.$set(e.myScore,"hotScore",t)},expression:"myScore.hotScore"}})],1),s("div",[s("Rate",{attrs:{disabled:"disabled","allow-half":"allow-half","show-text":"show-text",character:"甜"},model:{value:e.myScore.sweetScore,callback:function(t){e.$set(e.myScore,"sweetScore",t)},expression:"myScore.sweetScore"}})],1)]):e._e()])],1)],1)},staticRenderFns:[]};var i=s("VU/8")(o,r,!1,function(e){s("pwH7")},"data-v-90da59d2",null);t.default=i.exports},pwH7:function(e,t){}});
//# sourceMappingURL=9.5dd467d76a77529f6de0.js.map